# @marianmeres/stuic - LLM Context File

## Package Overview
- **Name**: @marianmeres/stuic
- **Type**: SvelteKit library (exports only, consumed as dependency)
- **Path**: workspace/stuic/src/lib
- **Framework**: Svelte 5 (runes: $state, $derived, $effect, $bindable, $props)
- **Styling**: TailwindCSS v4
- **Description**: Opinionated Svelte 5 UI component library with accessible, customizable components, utilities, and actions

## Directory Structure
```
src/lib/
├── index.ts              # Main exports
├── index.css             # Global styles
├── types.ts              # Global types (DataAttributes, TranslateFn, TW_COLORS)
├── components/           # 24 component categories
├── utils/                # 39 utility modules
└── actions/              # 10 Svelte actions
```

## Main Exports Pattern
```ts
import { Button, Modal, Notifications } from '@marianmeres/stuic';  // components
import { twMerge, debounce, localStorageState } from '@marianmeres/stuic';  // utilities
import { focusTrap, validate, autogrow } from '@marianmeres/stuic';  // actions
```

---

## COMPONENTS

### AlertConfirmPrompt
Modern replacement for native browser dialogs.
- **Exports**: `AlertConfirmPrompt`, `AlertConfirmPromptStack`, `createAlert()`, `createConfirm()`, `createPrompt()`
- **Types**: `AlertConfirmPromptType` (enum: ALERT/CONFIRM/PROMPT), `AlertConfirmPromptVariant`, `AlertConfirmPromptObj`
- **Usage**:
```ts
const acp = new AlertConfirmPromptStack({ labelOk: 'OK', labelCancel: 'Cancel' });
acp.alert({ title: 'Notice', content: 'Done' });
acp.confirm(() => console.log('yes'), { title: 'Delete?', variant: 'warn' });
acp.prompt((val) => console.log(val), { title: 'Name?', value: '' });
// Promise-based:
const alert = createAlert(acp);
await alert('Hello!');
```

### AnimatedEllipsis
Animated loading ellipsis (...).
- **Exports**: `AnimatedEllipsis`

### AppShell
Main layout wrapper/container.
- **Exports**: `AppShell`, `appShellSetHtmlBodyHeight()`, `MAIN_WIDTH`

### Backdrop
Semi-transparent overlay for modals.
- **Exports**: `Backdrop`

### Button
Primary button with variants.
- **Exports**: `Button`, `BUTTON_STUIC_BASE_CLASSES`, `BUTTON_STUIC_PRESET_CLASSES`
- **Props**: `variant` (primary/secondary), `size` (sm/md/lg), `muted`, `noshadow`, `noborder`, `unstyled`, `inverse`, `href`, `roleSwitch`, `checked`
- **Usage**:
```svelte
<Button variant="primary" size="sm">Click</Button>
<Button href="/page">Link</Button>
<Button roleSwitch bind:checked>Toggle</Button>
```

### ButtonGroupRadio
Radio button group displayed as buttons.
- **Exports**: `ButtonGroupRadio`

### ColorScheme
Dark mode management.
- **Exports**: `ColorSchemeLocal`, `ColorSchemeSystemAware`

### CommandMenu
Command palette interface.
- **Exports**: `CommandMenu`

### DismissibleMessage
Message with close button.
- **Exports**: `DismissibleMessage`

### Drawer
Slide-out drawer/sidebar panel.
- **Exports**: `Drawer`

### HoverExpandableWidth
Element that expands on hover.
- **Exports**: `HoverExpandableWidth`

### Input (Form Fields)
Complete form building system.
- **Exports**: `FieldAssets`, `FieldCheckbox`, `FieldFile`, `FieldInput`, `FieldLikeButton`, `FieldOptions`, `FieldRadios`, `FieldSelect`, `FieldSwitch`, `FieldTextarea`, `Fieldset`
- **Types**: `FieldSelectOption`, `FieldRadiosOption`
- **Internal**: `InputWrap` (wrapper with labels, descriptions, validation)

### KbdShortcut
Display keyboard shortcut hints.
- **Exports**: `KbdShortcut`

### Modal
Basic modal dialog.
- **Exports**: `Modal`

### ModalDialog
Enhanced modal with more features.
- **Exports**: `ModalDialog`

### Notifications
Reactive notification queue system.
- **Exports**: `Notifications`, `NotificationsStack`
- **Types**: `NotificationInput`, `Notification`, `NotificationType` (info/success/warn/error), `NotificationsSortOrder`, `NotificationsStackOptions`, `ComponentWrap`
- **Usage**:
```ts
const notifications = new NotificationsStack([], { maxCapacity: 5, defaultTtl: 5000 });
notifications.info('Operation completed');
notifications.success('Saved!');
notifications.warn('Low disk');
notifications.error('Failed', { ttl: 0 });  // Won't auto-dismiss
notifications.removeById('id');
notifications.destroy();  // Cleanup
```
- **Features**: Auto-disposal by TTL, deduplication, capacity limits, progress tracking

### Progress
Progress indication.
- **Exports**: `Progress`
- **Internal**: `Bar`, `Circle`

### SlidingPanels
Multi-panel sliding layout.
- **Exports**: `SlidingPanels`

### Spinner
Loading spinners.
- **Exports**: `Spinner`, `SpinnerCircle`, `SpinnerUnicode`, `spinnerCreateBackAndForthCharFrames()`, `SpinnerUnicodeVariant`

### Switch
Toggle controls.
- **Exports**: `Switch`, `SwitchButton`

### Thc (Text/Html/Component)
Universal content renderer.
- **Exports**: `Thc`, `THC` (type), `isTHCNotEmpty()`, `getTHCStringContent()`
- **THC Type**:
```ts
type THC = string | { text: string } | { html: string } | { component: any, props?: any } | { snippet: Snippet } | Snippet;
```
- **Usage**:
```svelte
<Thc thc="plain text" />
<Thc thc={{ html: '<b>bold</b>' }} />
<Thc thc={{ component: MyComponent, props: { foo: 'bar' } }} />
```

### TwCheck
Tailwind-styled checkbox.
- **Exports**: `TwCheck`

### TypeaheadInput
Auto-complete input field.
- **Exports**: `TypeaheadInput`

### X
Close/dismiss button.
- **Exports**: `X`

---

## UTILITIES

### Storage & State

**persistent-state.svelte.ts**
```ts
import { localStorageState, sessionStorageState } from '@marianmeres/stuic';
const theme = localStorageState('theme', 'light');
theme.current = 'dark';  // Auto-persisted
theme.reset();  // Reset to initial
```

**storage-abstraction.ts**
```ts
import { StorageAbstraction, MemoryStorage, localStorageValue, sessionStorageValue, memoryStorageValue } from '@marianmeres/stuic';
const storage = new StorageAbstraction('local');
storage.set(key, value);
storage.get(key);
```

**switch.svelte.ts**
```ts
import { SwitchState } from '@marianmeres/stuic';
// 3-state switch (true/false/null) with optional data
```

### Reactive/Media Query

**breakpoint.svelte.ts**
```ts
import { Breakpoint } from '@marianmeres/stuic';
const bp = new Breakpoint();
bp.current  // 'sm' | 'md' | 'lg' | 'xl' | '2xl' | null
bp.md       // boolean: >= 768px
bp.lg       // boolean: >= 1024px
```

**device-pointer.svelte.ts**
```ts
import { DevicePointer } from '@marianmeres/stuic';
const pointer = new DevicePointer();
pointer.isNone   // no pointer
pointer.isCoarse // touch device
pointer.isFine   // mouse
```

**prefers-reduced-motion.svelte.ts** - Detect user motion preferences

**observe-exists.svelte.ts** - DOM observer utility

### HTML & DOM

- **body-scroll-locker.ts** - Lock/unlock body scroll
- **event-emitter.ts** - `EventEmitter` class with `.on()`, `.off()`, `.once()`, `.emit()`, `.removeAllListeners()`
- **event-modifiers.ts** - Keyboard modifier detection
- **qsa.ts** - querySelector shortcuts
- **paint.ts** - DOM painting utilities
- **svg-circle.ts** - SVG circle utilities

### File Handling

- **file-from-bloburl.ts** - Convert blob URLs to files
- **force-download.ts** - Trigger file download
- **get-file-type-label.ts** - MIME type labels
- **is-image.ts** - Image type detection
- **preload-img.ts** - Image preloading

### Object/Type Utilities

**omit-pick.ts**
```ts
import { omit, pick } from '@marianmeres/stuic';
omit({ a: 1, b: 2 }, ['b']);  // { a: 1 }
pick({ a: 1, b: 2 }, ['a']);  // { a: 1 }
```

- **is-plain-object.ts**, **is-nullish.ts** - Type detection
- **maybe-json-parse.ts**, **maybe-json-stringify.ts** - Safe JSON ops
- **replace-map.ts** - String replacement with map

### String Utilities

**tr.ts** - Locale translation
```ts
import { tr } from '@marianmeres/stuic';
tr({ en: 'Hello', sk: 'Ahoj' }, 'sk');  // 'Ahoj'
```

- **ucfirst.ts** - Uppercase first char
- **unaccent.ts** - Remove diacritics
- **escape-regex.ts** - Escape regex special chars
- **nl2br.ts** - Newlines to `<br>`
- **str-hash.ts** - String hashing
- **get-id.ts** - Generate unique IDs

### Timing & Async

```ts
import { debounce, throttle, sleep } from '@marianmeres/stuic';
const debouncedFn = debounce(fn, 300);
const throttledFn = throttle(fn, 100);
await sleep(1000);
```

- **oscillate.ts** - Value oscillation
- **seconds.ts** - Time unit conversion
- **to-integer.ts** - String to integer

### Tailwind & Styling

**tw-merge.ts**
```ts
import { twMerge, clsClean } from '@marianmeres/stuic';
twMerge('px-2 py-1', 'px-4');  // 'py-1 px-4' (conflict resolved)
clsClean('foo   bar\n\tbaz'); // 'foo bar baz'
```

**colors.ts** - Color conversions: `hexToOklch()`, `rgbToOklch()`, `hexToRgb()`, etc.

### Environment

- **is-browser.ts** - Browser detection
- **is-mac.ts** - macOS detection

---

## ACTIONS

### autogrow
Auto-expand textarea height.
```svelte
<textarea use:autogrow={{ min: 100, max: 500 }} />
```
**Options**: `enabled`, `min`, `max`, `immediate`, `value`

### autoscroll
Auto-scroll element into view.
```svelte
<div use:autoscroll />
```

### file-dropzone
Drag-drop file handler.
```svelte
<div use:fileDropzone={{ inputEl, processFiles: (files) => {} }} />
```
**Options**: `enabled`, `inputEl` (required), `allowClick`, `processFiles`

### focus-trap
Trap keyboard focus in container (modal accessibility).
```svelte
<div use:focusTrap={{ enabled: isOpen, autoFocusFirst: true }}>
  <button>First</button>
  <input />
  <button>Last (Tab wraps)</button>
</div>
```
**Features**: Tab wrapping, MutationObserver for dynamic elements

### highlight-dragover
Highlight element on drag-over.
```svelte
<div use:highlightDragover />
```

### on-submit-validity-check
Form validation on submit.
```svelte
<form use:onSubmitValidityCheck />
```

### resizable-width
Make element width resizable.
```svelte
<div use:resizableWidth />
```

### tooltip
Tooltip with positioning.
```svelte
<button use:tooltip={{ content: 'Hint' }}>Hover</button>
```

### trim
Auto-trim whitespace.
```svelte
<input use:trim />
```

### validate
Form field validation.
```svelte
<input use:validate={{ rules: [...] }} />
```

---

## GLOBAL TYPES (types.ts)

```ts
// HTML data-* attributes
type DataAttributes = { [key: `data-${string}`]: string | number | boolean };

// i18n translation function signature
type TranslateFn = (k: string, values?: Record<string, any>, fallback?: string | boolean, i18nSpanWrap?: boolean) => string;

// Tailwind color palette names
type TW_COLORS = 'amber' | 'blue' | 'cyan' | 'emerald' | 'fuchsia' | 'gray' | 'green' | 'indigo' | 'lime' | 'neutral' | 'orange' | 'pink' | 'purple' | 'red' | 'rose' | 'sky' | 'slate' | 'stone' | 'teal' | 'violet' | 'yellow' | 'zinc';
```

---

## KEY PATTERNS & CONVENTIONS

### Svelte 5 Runes
- `$state` for reactive state
- `$derived` / `$derived.by` for computed values
- `$effect` for side effects
- `$bindable` for two-way binding
- `$props` for component props
- Snippets with `@render` for composition

### Component Organization
- PascalCase component names
- Each component in own directory with `index.ts`
- `_internal/` for private implementations
- CSS modules co-located

### THC Pattern (Text/Html/Component)
Universal content type for flexible rendering:
```ts
type THC = string | { text } | { html } | { component, props } | { snippet } | Snippet;
```

### Stack Managers
Queue-based UI patterns (NotificationsStack, AlertConfirmPromptStack):
- FIFO queue with auto-disposal
- Deduplication, TTL, capacity management
- Use `$state` for reactivity

### Reactive Classes
Media-query/state reactivity via `$derived`:
```ts
class ReactiveClass {
  #value = $derived.by(() => { /* computation */ });
  get propName() { return this.#value; }
}
```

### Storage Pattern
Unified interface for localStorage/sessionStorage/memory with SSR fallback.

### Tailwind Integration
- `twMerge()` for intelligent class merging
- Base class constants (e.g., `BUTTON_STUIC_BASE_CLASSES`)
- Preset variant classes

### Accessibility
- Focus trap for modals
- ARIA attributes
- Keyboard navigation
- Reduced motion detection

---

## EXTERNAL DEPENDENCIES
- `@marianmeres/clog` - Debug logging
- `@marianmeres/ticker` - Interval ticker
- `tailwind-merge` - Class conflict resolution
